# Keystore
项目名：钥匙盒， 用于个人在电脑上离线保存记录在各平台上账号密码。
# 密码管理软件开发计划

## 一、项目概述
### 1.1 项目名称
SecurePass Manager (SPM)

### 1.2 核心功能
- 安全的密码录入与存储
- 加密的本地数据存储
- 便捷的密码查询与检索
- 易于备份与转移的数据格式

## 二、技术栈
### 2.1 开发框架
- **Qt 6.4+** (跨平台GUI框架)
- **C++17** (核心编程语言)

### 2.2 加密方案
- **加密库**: OpenSSL 3.0+ 或 Qt Cryptography
- **主密码加密**: Argon2id (密钥派生函数)
- **数据加密**: AES-256-GCM (对称加密)
- **数据库加密**: SQLCipher 或自定义加密层

### 2.3 数据存储
- **本地数据库**: SQLite (加密格式)
- **备份格式**: JSON (加密后存储)
- **配置文件**: INI格式 (存储基础配置)

## 三、详细需求说明

### 3.1 核心功能模块

#### 3.1.1 用户认证模块
- 首次使用创建主密码
- 主密码强度验证
- Argon2id密钥派生，存储salt和参数
- 支持生物识别(可选，平台依赖)

#### 3.1.2 密码录入模块
- 表单字段：
  - 网站/应用名称 (必填)
  - 用户名/邮箱 (必填)
  - 密码 (必填)
  - URL (可选)
  - 备注/分类标签 (可选)
  - 自动生成密码选项
- 密码生成器：
  - 可配置长度(8-64)
  - 字符类型选择(大小写、数字、符号)
  - 排除易混淆字符
- 批量导入功能：
  - CSV格式导入
  - 浏览器导出格式兼容

#### 3.1.3 密码查询模块
- 全文搜索：
  - 网站名称模糊匹配
  - 用户名/邮箱搜索
  - 标签分类筛选
- 搜索结果展示：
  - 列表视图
  - 网格视图(可选)
- 密码查看：
  - 点击显示(需要主密码验证)
  - 复制到剪贴板(自动清除时间可配置)
  - 隐藏密码显示(星号/圆点)

#### 3.1.4 数据加密模块
**三层加密架构：**
1. 数据库层加密(SQLCipher或AES-256)
2. 字段级额外加密(敏感字段双重加密)
3. 备份文件整体加密(AES-256-GCM)

**密钥管理：**
- 主密码 → Argon2id → 主密钥
- 主密钥加密数据密钥
- 数据密钥加密实际数据

#### 3.1.5 备份与恢复模块
- **自动备份**:
  - 每日/每周自动加密备份
  - 保留最近N个版本
- **手动备份**:
  - 导出加密JSON文件
  - 可选择包含元数据
- **恢复功能**:
  - 选择备份文件恢复
  - 合并恢复选项
  - 冲突解决机制

#### 3.1.6 安全功能
- 自动锁定功能(闲置超时)
- 剪贴板自动清除(可配置时间)
- 主密码尝试次数限制
- 安全审计日志(加密存储)
- 弱密码检测与提醒

### 3.2 用户界面设计
#### 3.2.1 主界面布局
```
+-----------------------------------------+
|  [搜索框] [添加] [导入] [设置]          |
+-----------------------------------------+
| 分类筛选 |  密码条目列表                |
|          |  +-------------------------+ |
| [全部]   |  | 🛒 Amazon              | |
| [网站]   |  |  用户: john@example.com| |
| [应用]   |  |                        | |
| [金融]   |  +-------------------------+ |
| [社交]   |  | 🎵 Spotify             | |
| [工作]   |  |  用户: john123         | |
|          |  +-------------------------+ |
+-----------------------------------------+
|             详情面板                    |
|  网站: Amazon                          |
|  用户: john@example.com                |
|  密码: ******** [显示] [复制] [编辑]   |
+-----------------------------------------+
```

#### 3.2.2 关键对话框
- 主密码设置/验证对话框
- 添加/编辑密码条目对话框
- 密码生成器对话框
- 导入/导出对话框
- 设置对话框

### 3.3 数据存储结构
```cpp
// 加密数据库表结构
Users: id, master_key_hash, salt, argon2_params
Entries: id, category, website, username, encrypted_password, 
         encrypted_notes, url, tags, created_at, updated_at
BackupHistory: id, backup_time, file_path, hash, size
SecurityLog: id, event_type, timestamp, ip_address(可选)
```

## 四、开发计划

### 阶段一：项目初始化与环境搭建 (2天)
#### 第1-2天
- 创建Qt项目结构
- 配置开发环境(Qt Creator/CMake)
- 集成加密库(OpenSSL/QtCrypto)
- 设计基础类结构
- 创建Git仓库，建立开发分支策略

### 阶段二：核心加密模块开发 (5天)
#### 第3-4天
- 实现Argon2id密钥派生函数
- 实现AES-256-GCM加密/解密函数
- 设计密钥管理类(KeyManager)
- 编写加密模块单元测试

#### 第5-7天
- 设计数据库加密层
- 实现SQLCipher集成或自定义加密层
- 创建数据模型类(Entry, Category等)
- 设计数据访问对象(DAO)模式

### 阶段三：用户界面开发 (7天)
#### 第8-10天
- 设计并实现主窗口框架
- 创建用户认证界面(登录/注册)
- 实现密码列表视图(QListView/QTableView)

#### 第11-14天
- 开发密码添加/编辑对话框
- 实现密码生成器组件
- 创建搜索和筛选功能
- 设计设置界面

### 阶段四：功能集成与完善 (6天)
#### 第15-17天
- 集成加密模块与数据层
- 实现完整的CRUD操作
- 添加数据验证和错误处理
- 实现自动锁定功能

#### 第18-20天
- 开发备份/恢复功能
- 实现导入/导出功能(CSV/JSON)
- 添加剪贴板管理功能
- 实现密码强度检查器

### 阶段五：测试与优化 (4天)
#### 第21-23天
- 单元测试(Google Test)
- 集成测试
- 安全性测试(模糊测试)
- 跨平台测试(Windows/Linux/macOS)

#### 第24天
- 性能优化
- 内存泄漏检查
- 用户体验优化
- 文档整理

### 阶段六：发布准备 (2天)
#### 第25-26天
- 创建安装包
- 编写用户手册
- 准备发布说明
- 最终安全检查

## 五、详细技术实现要点

### 5.1 核心加密实现
```cpp
class CryptoManager {
private:
    QByteArray deriveKey(const QString& password, const QByteArray& salt);
    QByteArray encryptData(const QByteArray& data, const QByteArray& key);
    QByteArray decryptData(const QByteArray& encrypted, const QByteArray& key);
    
public:
    bool initialize(const QString& masterPassword);
    bool saveEntry(const PasswordEntry& entry);
    PasswordEntry loadEntry(int id);
    QByteArray createBackup();
    bool restoreBackup(const QByteArray& backupData);
};
```

### 5.2 数据库设计
```sql
-- 使用PRAGMA指令配置SQLite加密(如果使用SQLCipher)
PRAGMA key = '加密密钥';
PRAGMA cipher_page_size = 4096;
PRAGMA kdf_iter = 64000;
```

### 5.3 备份策略
- **完整备份**: 加密整个数据库文件
- **增量备份**(可选): 只备份变更条目
- **云备份**(可选): 集成WebDAV或自定义服务器
- **本地备份**: 加密压缩文件，包含时间戳和版本号

## 六、安全考虑
1. **内存安全**: 敏感数据在内存中加密
2. **防暴力破解**: 主密码尝试延迟和锁定
3. **侧信道防护**: 时序攻击防护
4. **安全删除**: 安全擦除内存和临时文件
5. **审计日志**: 记录所有关键操作

## 七、风险与缓解
1. **加密库风险**: 使用成熟加密库，定期更新
2. **数据损坏风险**: 实施备份验证和完整性检查
3. **兼容性风险**: 使用标准加密算法和文件格式
4. **性能风险**: 优化加密操作，使用适当的参数

## 八、交付物
1. 可执行程序(Windows/Linux/macOS)
2. 源代码(带注释)
3. 技术设计文档
4. 用户使用手册
5. 测试报告
6. 安全审计报告

## 九、后续优化建议
1. 浏览器扩展集成
2. 移动端同步应用
3. 双因素认证支持
4. 密码共享功能(端到端加密)
5. 密码过期提醒
6. 密码健康报告

---
**总开发时间**: 26个工作日  
**项目启动时间**: [填写实际开始日期]  
**预计完成时间**: [根据启动日期计算]  

这个计划提供了详细的开发路线图，您可以根据实际需求调整时间安排和功能优先级。需要我开始编写具体的实现代码吗？
